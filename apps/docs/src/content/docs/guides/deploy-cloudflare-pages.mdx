---
title: Deploy on Cloudflare Pages
description: Production and preview deployment setup for the docs app.
sidebar:
  order: 1
---

## Recommended Cloudflare Setup

This project uses Astro static output and deploys to a Cloudflare Pages project named `scholar-mcp-docs`.

Configure the Cloudflare build settings as follows:

- Path: `apps/docs` (no leading slash)
- Build command: `pnpm install --frozen-lockfile && pnpm build`
- Deploy command: `pnpm run cf:pages:deploy:ci`
- Non-production branch deploy command: `pnpm run cf:pages:deploy:preview:ci`
- Production branch: `main`

The deploy commands above call repo-managed scripts in `apps/docs/package.json`:

- `cf:pages:deploy`: unsets `CLOUDFLARE_API_TOKEN` / `CF_API_TOKEN`, then runs `wrangler pages deploy ./dist --project-name scholar-mcp-docs`
- `cf:pages:deploy:preview`: same token-safe behavior with `--branch ${WORKERS_CI_BRANCH:-preview}`
- `cf:pages:deploy:ci`: alias of token-safe production deploy
- `cf:pages:deploy:preview:ci`: alias of token-safe preview deploy

## Authentication (Important)

If builds fail with `Authentication error [code: 10000]`, check environment variables for `CLOUDFLARE_API_TOKEN`.

- Best practice: do **not** set `CLOUDFLARE_API_TOKEN` in Workers Builds unless you need a custom token. Let Cloudflare use the default build token.
- If you do use a custom token, it must include Cloudflare Pages edit/write permission for the target account.
- This repo's deploy scripts explicitly unset `CLOUDFLARE_API_TOKEN` / `CF_API_TOKEN` to avoid accidental use of a mis-scoped token.

## Pages Project Settings

- Framework preset: `Astro`
- Root directory: repository root (or use `Path: apps/docs` as shown above)
- Build command (root-based alternative): `pnpm install --frozen-lockfile && pnpm --filter @scholar-mcp/docs build`
- Build output directory: `apps/docs/dist`
- Production branch: `main`

## Build Watch Paths

Recommended include paths:

- `apps/docs/**`
- `packages/scholar-mcp/src/**`
- `packages/scholar-mcp/package.json`
- `scripts/**`
- `README.md`
- `package.json`
- `pnpm-lock.yaml`

## Local Preview and Deploy via Wrangler

```bash
cd apps/docs
pnpm run build
npx wrangler pages dev ./dist
```

Production deploy from local machine:

```bash
cd apps/docs
pnpm run build
pnpm run cf:pages:deploy
```

Preview deploy from local machine:

```bash
cd apps/docs
pnpm run build
WORKERS_CI_BRANCH=preview pnpm run cf:pages:deploy:preview
```

## Site URL Best Practice

Set `DOCS_SITE_URL` in Cloudflare environment variables for canonical URLs and sitemap generation.

- Example: `DOCS_SITE_URL=https://docs.example.com`
- Fallback default in this project: `https://scholar-mcp-docs.pages.dev`
